var begin_form='';var form_fields=new Array();var serialized_form_fields=new Array();$(document).ready(function(){var i=0;$('[name=filters_open]').find('input').each(function(){var formname=$(this).parent('form').attr('name');if(formname!='list_queries_open'&&formname!='open_queries'&&formname!='save_query'){if($.inArray($(this).attr('name'),form_fields)==-1){form_fields[i]=$(this).attr('name');i++}}});$.each(form_fields,function(index,value){serialized_form_fields[value]=$('[name=filters_open]').find('[name='+value+']').serialize()});begin_form=$('[name=filters_open]').serialize();$('[:input').live("change",function(){filter_highlight_changes($(this))});$(':checkbox').live("click",function(){filter_highlight_changes($(this))})});function filter_toggle_field_changed(field){var field_type=field.attr('type');var starting_value=serialized_form_fields[field.attr('name')];var current_value=field.serialize();if(field_type=='checkbox'&&current_value==''){current_value=undefined}if(current_value!=starting_value){filter_field_dirty(field)}else{filter_field_clean(field)}}function filter_highlight_changes(item){filter_toggle_field_changed(item);var changed_form=$('[name=filters_open]').serialize();if(begin_form==changed_form){filter_clean_all()}}function filter_named_filter_clean(){var selected_text=$('[name=source_query_id] option:selected').html();if(selected_text.charAt(0)=='*'){$('[name=source_query_id]').removeClass('tainted');var reset_text=selected_text.substring(2,selected_text.length);$('[name=source_query_id] option:selected').html(reset_text)}}function filter_named_filter_dirty(){var stored_query_id=$('[name=source_query_id]').val();if(stored_query_id==-1){return}var selected_text=$('[name=source_query_id] option:selected').html();if(selected_text.charAt(0)!='*'){$('[name=source_query_id] option:selected').prepend('* ');$('[name=source_query_id]').addClass('tainted')}}function filter_field_clean(item){item.parent().removeClass('tainted')}function filter_field_dirty(item){if(!item.parent().hasClass('tainted')){filter_named_filter_dirty();item.parent().addClass('tainted')}}function filter_clean_all(){filter_named_filter_clean();$('.tainted').each(function(){$(this).removeClass('tainted')})}
